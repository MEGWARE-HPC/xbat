---
title: Maintenance
description: Database backup and maintenance
---

::Headline

## MongoDB

::

MongoDB provides multiple ways to perform backups and restores.

::Headline

### Backup and Restore via CLI Tools

::

MongoDB provides command-line tools `mongodump` and `mongorestore` for logical database backups and restores.
It is recommended to perform backups during periods of low activity to avoid inconsistencies.

To create a logical backup of the MongoDB database, the following command can be used:

::codeblock

```bash
mongodump \
  --host <host> \
  --port <port> \
  --username <user> \
  --password <password> \
  --authenticationDatabase admin \
  --db <database> \
  --out /path/for/backup/mongodb_backup
```

::

To restore the backup, the following command can be used:

::codeblock

```bash
mongorestore \
  --host <host> \
  --port <port> \
  --username <user> \
  --password <password> \
  --authenticationDatabase admin \
  --db <database> \
  --drop \
  /path/for/backup/mongodb_backup/<database>
```

::

::banner{type=warning}
WARNING - Using the `--drop` option will delete any existing data in the database before restoring.
This may lead to permanent data loss! Always ensure you have a valid backup before restoring.
::

::Headline

### Filesystem-level Backup

::

Alternatively, a filesystem-level backup of MongoDB data can be performed by archiving the data directory.
This approach requires that MongoDB is stopped before copying files to ensure data consistency.
If running a replica set, backups can be performed from a secondary node without stopping the primary.

::codeblock

```bash
systemctl stop mongod
cd /var/lib/mongodb
tar -czvf /path/for/backup/mongodb_data_backup.tar.gz *
systemctl start mongod
```

::

To restore from a filesystem backup:

::codeblock

```bash
systemctl stop mongod
tar -xzvf mongodb_data_backup.tar.gz -C /var/lib/mongodb
chown -R mongodb:mongodb /var/lib/mongodb
systemctl start mongod
```

::

::Headline

## QuestDB

::

It is recommended to put QuestDB into checkpoint mode before performing a backup. Head to `<host>:7000/questdb/` and execute `CHECKPOINT CREATE`. When the backup is done execute `CHECKPOINT RELEASE` to revert QuestDB to normal operation.

QuestDB does not provide a dedicated backup mechanism, but instead relies on the user to `cp` or `rsync` the files to a backup location. The following command can be used to backup the QuestDB data directory:

::codeblock

```bash
cd /var/lib/xbat/questdb
tar -czvf /path/for/backup/questdb_backup.tar.gz *
```

::
To restore the backup, the following command can be used:

::codeblock

```bash
tar -xzvf questdb_backup.tar.gz -C /var/lib/xbat/questdb
```

::

Check the [QuestDB documentation](https://questdb.io/docs/operations/backup/){:target="_blank"} for further details.

::Headline

### Purging QuestDB Data

::

Deleting benchmarks in xbat removes them from the MongoDB database. However, since QuestDB does not support the DELETE operation, there is no direct way of removing data within the constraints of xbat. Administrators can manually trigger a purge of deleted benchmarks from QuestDB by clicking _Purge QuestDB_ in the xbat interface (Overview > Actions). To avoid any issues with running jobs, this action should only be performed when certain that no xbat jobs are currently running (e.g. when cluster is in drain/maintenance). It is recommended to restart `xbat` after purging QuestDB data to rebuild database indexes.

::banner{type=warning}
WARNING - THIS ACTION MAY LEAD TO PERMANENT DATA LOSS! MAKE A BACKUP BEFORE EXECUTING PURGE!
::
